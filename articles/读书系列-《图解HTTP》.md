# 读书系列-《图解HTTP》
## 第 1 章　了解 Web 及网络基础
### 1.1　使用 HTTP 协议访问 Web
Web 使用一种名为 HTTP（HyperText Transfer Protocol，超文本传输协议）的协议作为规范，完成从客户端到服务器端等一系列运作流 程。而协议是指规则的约定。可以说，**Web 是建立在 HTTP 协议上通信的。**

### 1.2　HTTP 的诞生

#### 1.2.1　为知识共享而规划 Web 

- **WWW（World Wide Web，万维网，也可简称为 Web）**这一提议是CERN（欧洲核子研究组织）的蒂姆 • 伯纳斯 - 李（Tim BernersLee） 博士提出的，致力于全世界的研究者们进行知识共享。

- WWW的构建技术：
  - 作为页面的文本标记语言的 **HTML**（HyperText Markup Language，超文本标记语言）； 
  - 作为文档传递协议的 **HTTP** ；
  - 指定文档所在地址的 **URL**（Uniform Resource Locator，统一资源定位符）

#### 1.2.2　Web 成长时代 

#### 1.2.3　驻足不前的 HTTP 

- **HTTP/0.9**：HTTP 于 1990 年问世，那时的 HTTP 并没有作为正式的标准被建立， 因此被称为 HTTP/0.9。 
- **HTTP/1.0 **：HTTP 正式作为标准被公布是在 1996 年的 5 月。
- **HTTP/1.1**：1997 年 1 月公布的 HTTP/1.1 是目前主流的 HTTP 协议版本。

### 1.3　网络基础 TCP/IP

#### 1.3.1　TCP/IP 协议族

- 计算机与网络设备要相互通信，双方就必须基于相同的方法，不同的硬件、操作系统之间的通信都需要一种规则。而我们就把这种规则称为 协议（protocol）。

- **TCP/IP 是互联网相关的各类协议族的总称 。**

#### 1.3.2　TCP/IP 的分层管理

TCP/IP 协议族按层次分别分为以下 4 层：

- **应用层**：应用层决定了向用户提供应用服务时通信的活动。比如：FTP（File Transfer Protocol，文件传输协议）和 DNS（Domain Name System，域名系统）服务，HTTP 协议也处于该层。
- **传输层**：传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。比如：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报协议）。
- **网络层（又名网络互连层**）：网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。
- **链路层（又名数据链路层，网络接口层）**：用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱 动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。

#### 1.3.3　TCP/IP 通信传输流

- 利用 TCP/IP 协议族进行网络通信时，会通过分层顺序与对方进行通 信。发送端从应用层往下走，接收端则往应用层往上走。

- 发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。这种把数据信息包装起来的做法称为封装（encapsulate）。（下图以HTTP请求为例）

  ![HTTP请求过程](../images/http图解1.1.3.png)

### 1.4　与 HTTP 关系密切的协议 : IP、TCP 和 DNS

#### 1.4.1　负责传输的 IP 协议

- IP（Internet Protocol）网际协议位于网络层。（**IP**和**IP地址**不同，IP其实是一种协议名称）。
- IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方 那里，则需要满足各类条件。其中两个重要的条件是**IP 地址**和**MAC 地址**（Media Access Control Address）。 

- IP 间的通信依赖 MAC 地址。在网络上，通信的双方在同一局域网 （LAN）内的情况是很少的，通常是经过多台计算机和网络设备中转 才能连接到对方。而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标。这时，会采用 ARP 协议（Address Resolution Protocol）。ARP 是一种用以解析地址的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址。（类似于快递公司送货，通过层层集散中心，最终到达客户手中）

#### 1.4.2　确保可靠性的 TCP 协议 

- TCP协议位于传输层，为了更容易传送大数据把数据分割，并且TCP 协议能够确认数据最终是否送达到对方。

- 为了准确无误地将数据送达目标处，TCP 协议采用了三次握手 （three-way handshaking）策略。若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发送相同的数据包。

  ![三次握手](../images/http图解1.4.2.png)

### 1.5　负责域名解析的 DNS 服务

- DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的协议。**DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。**

  ![DNS服务](../images/http图解1.5.png)

### 1.6　各种协议与 HTTP 协议的关系

-  IP 协议、TCP 协议和 DNS 服务在使用 HTTP 协议的通信过程中各自发挥的作用

  ![各种协议与HTTP协议的关系](../images/http图解1.6.png)

### 1.7　URI 和 URL

- URI（Uniform Resource Identifier ，统一资源标识符）。
- URL（Uniform Resource Locator，统一资源定位符）。

#### 1.7.1　统一资源标识符 

- URI 用字符串标识某一互联网资源，而 URL 表示资源的地点（互联网上所处的位置）。可见 URL 是 URI 的子集。 

#### 1.7.2　URI 格式 

![URI格式](../images/http图解1.7.2.png)

## 第 2 章　简单的 HTTP 协议

### 2.1　HTTP 协议用于客户端和服务器端之间的通信

- 请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端。
- 在两台计算机之间使用 HTTP 协议通信时，在一条通信线路上必定有一端是客户端，另一端则是服务器端。

### 2.2　通过请求和响应的交换达成通信

- **请求报文**是由请求方法、请求 URI、协议版本、可选的请求首部字段和内容实体构成的。
- **响应报文**基本上由协议版本、状态码（表示请求成功或失败的数字代码）、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

### 2.3　HTTP 是不保存状态的协议

HTTP 是一种不保存状态，即**无状态（stateless）协议**。

- 优点：更快地处理大量事务，确保协议的可伸缩性。
- 缺点：无法实现保持状态功能（引入了 Cookie 技术）。

### 2.4　请求 URI 定位资源

- HTTP 协议使用 URI 定位互联网上的资源，当客户端请求访问资源而发送请求时，URI 需要被作为请求报文中的请求 URI 包含在内。

### 2.5　告知服务器意图的 HTTP 方法

### 2.6　使用方法下达命令

![HTTP的请求方法](../images/http图解2.6.png)

### 2.7　持久连接节省通信量

HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接，可随着 HTTP 的普及，文档中包含大量图片的情况多了起来，每次的请求都会造成无谓的 TCP 连接建立和断开，**增加通信量的开销**。

#### 2.7.1　持久连接 

- 简介：在 HTTP/1.1 中，所有的连接默认都是持久连接（HTTP Persistent Connections，也称为 HTTP keep-alive 或 HTTP connection reuse），但在 HTTP/1.0 内并未标准化。
- 特点：只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。
- 好处：减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应提高了。

#### 2.7.2　管线化

管线化技术（pipelining）能够做到同时并行发送多个请求，而不需要一个接一个地等待响应。

### 2.8　使用 Cookie 的状态管理

- HTTP 是无状态协议，无法根据之前的状态进行本次的请求处理。于是Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。

- Cookie 会根据从服务器端发送的响应报文内的一个叫做 **Set-Cookie **的 首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie 值后发送出去。
  服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一 个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

  ![使用 Cookie 的状态管理](../images/http图解2.8.png)

## 第 3 章　HTTP 报文内的 HTTP 信息